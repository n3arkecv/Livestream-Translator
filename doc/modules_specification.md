# âš™ï¸ Modules Specification â€” Real-Time YouTube Live Translation App

---

## ğŸ§© ç¸½è¦½

æœ¬æ–‡ä»¶å®šç¾©å„å€‹æ¨¡çµ„çš„æ ¸å¿ƒåŠŸèƒ½ã€è³‡æ–™ä»‹é¢ã€äº‹ä»¶æ©Ÿåˆ¶èˆ‡ä¾è³´é—œä¿‚ã€‚  
æ‰€æœ‰æ¨¡çµ„å‡ä»¥ **ç¨ç«‹åŸ·è¡Œå–®å…ƒ** è¨­è¨ˆï¼Œèƒ½å–®ç¨æ¸¬è©¦èˆ‡æ›¿æ›ã€‚  

æ•´é«”æ¡ç”¨ **äº‹ä»¶é©…å‹• + éé˜»å¡å¼ï¼ˆasync I/Oï¼‰æ¶æ§‹**ï¼Œ  
é€éä¸­å¤®äº‹ä»¶ç®¡ç†å™¨ï¼ˆå¯ç”± Cursor Agent ç”Ÿæˆï¼‰å”èª¿æ¨¡çµ„ä¹‹é–“çš„è¨Šæ¯æµã€‚

---

## 1. GUI æ¨¡çµ„

| é …ç›® | èªªæ˜ |
|------|------|
| **æ¨¡çµ„åç¨±** | `gui_manager.py` |
| **åŠŸèƒ½æ¦‚è¦** | æä¾›ä½¿ç”¨è€…æ“ä½œä»‹é¢èˆ‡ç³»çµ±æ§åˆ¶ï¼ŒåŒ…æ‹¬ï¼šé–‹å§‹/åœæ­¢ã€éŸ³æºé¸æ“‡ã€Overlay è¨­å®šã€STT æ¨¡å‹è¨­å®šã€Log é¡¯ç¤ºã€‚ |
| **æ¡†æ¶** | PyQt / PySide |
| **ä¸»è¦çµ„ä»¶** | `MainWindow`ã€`SettingsPanel`ã€`LogView` |

### ğŸ”Œ Input / Output
| é¡å‹ | åç¨± | è³‡æ–™çµæ§‹ / å‹åˆ¥ | æè¿° |
|------|------|-----------------|------|
| Input | ä½¿ç”¨è€…æ“ä½œ | GUI äº‹ä»¶ | æŒ‰éµã€è¨­å®šå€¼æ”¹è®Š |
| Output | æ§åˆ¶æŒ‡ä»¤ | `start`, `stop`, `update_config` | å‚³é€çµ¦æ ¸å¿ƒæµç¨‹æˆ–å…¶ä»–æ¨¡çµ„ |

### âš¡ äº‹ä»¶
| äº‹ä»¶åç¨± | èªªæ˜ |
|-----------|------|
| `on_start` | ä½¿ç”¨è€…æŒ‰ä¸‹é–‹å§‹éµå¾Œè§¸ç™¼ä¸»æµç¨‹å•Ÿå‹• |
| `on_stop` | çµæŸæ‰€æœ‰æ ¸å¿ƒæ¨¡çµ„é‹ä½œ |
| `on_update_setting` | ä¿®æ”¹éŸ³æºæˆ–æ¨¡å‹å¾Œå»£æ’­è¨­å®šæ›´æ–° |

### ğŸ§  ä¾è³´
- è®€å– `config.json`
- èˆ‡ Overlay æ¨¡çµ„å…±ç”¨éƒ¨åˆ† UI è¨­å®šï¼ˆé€æ˜åº¦ã€èƒŒæ™¯é–‹é—œï¼‰
- å‘¼å« System Log ä»¥è¨˜éŒ„æ“ä½œäº‹ä»¶

---

## 2. Overlay æ¨¡çµ„

| é …ç›® | èªªæ˜ |
|------|------|
| **æ¨¡çµ„åç¨±** | `overlay_display.py` |
| **åŠŸèƒ½æ¦‚è¦** | è² è²¬é¡¯ç¤ºå­—å¹•ã€ç¿»è­¯èˆ‡æƒ…å¢ƒæ‘˜è¦ï¼Œæ”¯æ´é€æ˜åº¦èˆ‡ä½ç½®æ‹–æ›³ã€‚ |

### ğŸ”Œ Input / Output
| é¡å‹ | åç¨± | è³‡æ–™çµæ§‹ / å‹åˆ¥ | æè¿° |
|------|------|-----------------|------|
| Input | `partial_text` | str | å³æ™‚è¾¨è­˜åˆ°çš„æ–‡å­— |
| Input | `translated_sentence` | str | å¥å­ç¿»è­¯å®Œæˆå¾Œé¡¯ç¤ºæ–‡å­— |
| Input | `scenario_context` | str | æœ€æ–°èªå¢ƒæ‘˜è¦ï¼ˆå­—é«”è¼ƒå°ï¼‰ |
| Output | ç„¡ | â€” | é¡¯ç¤ºåœ¨è¢å¹•ä¸Š |

### âš¡ äº‹ä»¶
| åç¨± | èªªæ˜ |
|------|------|
| `on_partial_update` | STT å‚³å…¥ partial transcript æ™‚è§¸ç™¼æ›´æ–° |
| `on_translation_ready` | ç¿»è­¯å®Œæˆå¾Œæ›´æ–°ç¿»è­¯å€å¡Š |
| `on_context_update` | æƒ…å¢ƒä¸Šä¸‹æ–‡æ›´æ–°æ™‚è§¸ç™¼ |

### ğŸ§  ä¾è³´
- æ¥æ”¶è³‡æ–™ä¾†è‡ª STT æ¨¡çµ„èˆ‡ LLM ç¿»è­¯æ¨¡çµ„
- èˆ‡ GUI æ¨¡çµ„å…±äº«é¡¯ç¤ºè¨­å®šï¼ˆé€æ˜åº¦ã€å­—é«”å¤§å°ç­‰ï¼‰

---

## 3. Audio Capture æ¨¡çµ„

| é …ç›® | èªªæ˜ |
|------|------|
| **æ¨¡çµ„åç¨±** | `audio/capture.py` |
| **åŠŸèƒ½æ¦‚è¦** | ä½¿ç”¨ **WASAPI (pyaudiowpatch)** Loopback æ¨¡å¼ç›´æ¥æ•ç²ç³»çµ±éŸ³é »è¼¸å‡ºï¼Œè‡ªå‹•æ ¼å¼è½‰æ›ä¸¦ç”¢ç”Ÿé‡ç–ŠéŸ³è¨Šç‰‡æ®µã€‚ |
| **æ¡†æ¶** | pyaudiowpatch (WASAPI) |

### ğŸ”Œ Input / Output
| é¡å‹ | åç¨± | è³‡æ–™çµæ§‹ / å‹åˆ¥ | æè¿° |
|------|------|-----------------|------|
| Input | Windows Audio Output | WASAPI Loopback | ç³»çµ±éŸ³é »è¼¸å‡ºæµ |
| Output | `audio_chunk` | numpy.ndarray(float32) | éŸ³è¨Šç‰‡æ®µï¼ˆ640msï¼Œfloat32 [-1.0, 1.0]ï¼‰ |
| Output | `chunk_metadata` | dict | åŒ…å« chunk_idã€overlap_msã€duration_ms |

### âš¡ äº‹ä»¶
| åç¨± | èªªæ˜ |
|------|------|
| `audio.stream_opened` | WASAPI è¨­å‚™æˆåŠŸé–‹å•Ÿæ™‚è§¸ç™¼ |
| `audio.chunk_ready` | æ¯ç”¢ç”Ÿä¸€å€‹ Chunk æ™‚è§¸ç™¼ï¼Œå‚³çµ¦ STT æ¨¡çµ„ |
| `audio.stream_closed` | åœæ­¢æ•ç²æ™‚è§¸ç™¼ |

### ğŸ§  ä¾è³´
- **pyaudiowpatch>=0.2.12.4**ï¼šWASAPI æ”¯æŒçš„ PyAudio åˆ†æ”¯
- **numpy>=1.26**ï¼šéŸ³é »æ•¸æ“šè™•ç†
- é©—è­‰éŸ³æºè¨­å‚™ï¼ˆç”± Runtime Check æ¨¡çµ„è¼”åŠ©ï¼‰
- System Log ç”¨æ–¼ç´€éŒ„éŸ³è¨Šè£ç½®ç‹€æ…‹èˆ‡ç•°å¸¸

### ğŸ“ æ ¸å¿ƒçµ„ä»¶
- **AudioCapture**ï¼šWASAPI Loopback æ•ç²ä¸»é¡
- **AudioFormatConverter**ï¼šè‡ªå‹•æ ¼å¼è½‰æ›ï¼ˆå¤šè²é“/ä»»æ„æ¡æ¨£ç‡ â†’ å–®è²é“/44100Hz/float32ï¼‰
- **ChunkProcessor**ï¼šé‡ç–Šåˆ‡ç‰‡è™•ç†

---

## 4. STT æ¨¡çµ„

| é …ç›® | èªªæ˜ |
|------|------|
| **æ¨¡çµ„åç¨±** | `stt_engine.py` |
| **åŠŸèƒ½æ¦‚è¦** | è™•ç†èªéŸ³è¾¨è­˜ï¼Œå¯é¸æ“‡æœ¬åœ°ï¼ˆFasterWhisperï¼‰æˆ– API æ¨¡å¼ï¼ˆGPT-4o / Gemini 2.5 Flashï¼‰ã€‚ |
| **æ¡†æ¶** | Async Thread + Model Wrapper |

### ğŸ”Œ Input / Output
| é¡å‹ | åç¨± | è³‡æ–™çµæ§‹ / å‹åˆ¥ | æè¿° |
|------|------|-----------------|------|
| Input | `audio_chunk` | numpy.ndarray | éŸ³è¨Šè³‡æ–™ï¼ˆå¸¶é‡ç–Šçš„ Chunkï¼‰ |
| Output | `partial_transcript` | str | å³æ™‚è¾¨è­˜æ–‡å­—ï¼ˆTranscript Words so farï¼‰ |
| Output | `final_sentence` | str | å®Œæ•´å¥å­ï¼ˆFully Transcribed Sentenceï¼Œè§¸ç™¼ç¿»è­¯ï¼‰ |

### âš¡ äº‹ä»¶
| åç¨± | èªªæ˜ |
|------|------|
| `on_partial_transcript` | è½‰éŒ„é€²è¡Œä¸­ï¼ˆDisplay Transcription so farï¼‰ |
| `on_revise_previous` | å¯©æŸ¥ä¸¦ä¿®æ­£å‰ä¸€å¥ï¼ˆReview & Correction previous sentenceï¼‰ |
| `on_final_sentence` | ä¸€å¥å®Œæ•´å¾Œè§¸ç™¼ç¿»è­¯ï¼ˆFully Transcribed Sentenceï¼‰ |

### ğŸ§  ä¾è³´
- Audio Capture æ¨¡çµ„ï¼ˆéŸ³è¨Šä¾†æºï¼‰
- LLM ç¿»è­¯æ¨¡çµ„ï¼ˆç¿»è­¯ç›®æ¨™ï¼‰
- System Logï¼ˆè¨˜éŒ„è¾¨è­˜æº–ç¢ºåº¦ã€å»¶é²ï¼‰
- Dialogue Logï¼ˆè¨˜éŒ„åŸæ–‡ï¼‰

---

## 5. LLM ç¿»è­¯æ¨¡çµ„

| é …ç›® | èªªæ˜ |
|------|------|
| **æ¨¡çµ„åç¨±** | `translator_llm.py` |
| **åŠŸèƒ½æ¦‚è¦** | è™•ç†èªå¥ç¿»è­¯èˆ‡æƒ…å¢ƒä¸Šä¸‹æ–‡æ›´æ–°ï¼Œç¶­æŒèªå¢ƒé€£è²«æ€§ã€‚ |
| **API æ¨¡å‹** | `gpt-4.1-mini-2025-04-14` |

### ğŸ”Œ Input / Output

**LLM1ï¼ˆç¿»è­¯ï¼‰ï¼š**
| é¡å‹ | åç¨± | è³‡æ–™çµæ§‹ / å‹åˆ¥ | æè¿° |
|------|------|-----------------|------|
| Input | `scenario_context` | str | æƒ…å¢ƒä¸Šä¸‹æ–‡ï¼ˆScenario Contextï¼‰ |
| Input | `fully_transcribed_sentence` | str | å®Œæ•´è½‰éŒ„çš„å¥å­ï¼ˆFully Transcribed Sentenceï¼‰ |
| Output | `translated_sentence` | str | ç¿»è­¯çµæœï¼ˆTranslated Sentenceï¼‰ |

**LLM2ï¼ˆæƒ…å¢ƒæ›´æ–°ï¼‰ï¼š**
| é¡å‹ | åç¨± | è³‡æ–™çµæ§‹ / å‹åˆ¥ | æè¿° |
|------|------|-----------------|------|
| Input | `original_scenario_context` | str | åŸå§‹æƒ…å¢ƒä¸Šä¸‹æ–‡ |
| Input | `translated_sentence` | str | ç¿»è­¯å¾Œçš„å¥å­ |
| Output | `new_scenario_context` | str | æ›´æ–°å¾Œçš„èªå¢ƒæ‘˜è¦ï¼ˆNew Scenario Contextï¼‰ |

### âš¡ äº‹ä»¶
| åç¨± | èªªæ˜ |
|------|------|
| `on_translation_ready` | LLM1 ç¿»è­¯å®Œæˆä¸¦å›å‚³çµæœï¼ˆTranslated Sentenceï¼‰ |
| `on_context_update` | LLM2 æ›´æ–°èªå¢ƒè¨˜æ†¶ï¼ˆNew Scenario Contextï¼‰ |
| `on_api_error` | ç¿»è­¯ API å‡ºéŒ¯æ™‚å›å ± System Log |

### ğŸ§  ä¾è³´
- æ¥æ”¶ STT Final Sentence  
- å›å‚³çµæœè‡³ Overlay èˆ‡ Dialogue Log  
- ä½¿ç”¨ System Log ç›£æ§ API å»¶é²èˆ‡ Token ä½¿ç”¨é‡  

---

## 6. Scenario Context ç®¡ç†æ¨¡çµ„

| é …ç›® | èªªæ˜ |
|------|------|
| **æ¨¡çµ„åç¨±** | `context_manager.py` |
| **åŠŸèƒ½æ¦‚è¦** | å„²å­˜ä¸¦ç¶­è­·ç¿»è­¯éç¨‹ä¸­çš„èªå¢ƒï¼ˆæœ€è¿‘ 200â€“500 tokensï¼‰ã€‚ |

### ğŸ”Œ Input / Output
| é¡å‹ | åç¨± | å‹åˆ¥ | æè¿° |
|------|------|------|------|
| Input | `new_sentence` | str | æ–°çš„åŸæ–‡æˆ–ç¿»è­¯å¥ |
| Output | `context_string` | str | æ›´æ–°å¾Œèªå¢ƒæ–‡å­— |

### âš¡ äº‹ä»¶
| åç¨± | èªªæ˜ |
|------|------|
| `on_context_update` | ç•¶èªå¢ƒè®Šæ›´æ™‚é€šçŸ¥ LLM èˆ‡ Overlay |

### ğŸ§  ä¾è³´
- LLM æ¨¡çµ„ï¼ˆæ›´æ–°ä¾†æºï¼‰
- Dialogue Logï¼ˆåŒæ­¥ä¿å­˜èªå¢ƒï¼‰

---

## 7. System Log æ¨¡çµ„

| é …ç›® | èªªæ˜ |
|------|------|
| **æ¨¡çµ„åç¨±** | `system_logger.py` |
| **åŠŸèƒ½æ¦‚è¦** | å¯¦æ™‚è¨˜éŒ„æ¨¡çµ„äº‹ä»¶ã€éŒ¯èª¤ã€è­¦å‘Šèˆ‡æ€§èƒ½çµ±è¨ˆã€‚ä½¿ç”¨é¡è‰²å€åˆ†äº‹ä»¶å±¤ç´šã€‚ |

### ğŸ”Œ Input / Output
| é¡å‹ | åç¨± | æè¿° |
|------|------|------|
| Input | `log_event` | ä»»æ„æ¨¡çµ„çš„ç‹€æ…‹æˆ–éŒ¯èª¤è¨Šæ¯ |
| Output | `.log` æª”æ¡ˆ / æ§åˆ¶å°æ–‡å­— | å½©è‰²åˆ†é¡è¼¸å‡ºï¼ˆè—=Info, é»ƒ=Warn, ç´…=Errorï¼‰ |

### âš¡ äº‹ä»¶
| åç¨± | èªªæ˜ |
|------|------|
| `log_info` | ä¸€èˆ¬äº‹ä»¶ |
| `log_warning` | æ½›åœ¨å•é¡Œ |
| `log_error` | éŒ¯èª¤èˆ‡ç•°å¸¸å ±å‘Š |

### ğŸ§  ä¾è³´
- æ‰€æœ‰æ¨¡çµ„å¯å‘¼å«  
- å¯«å…¥éé˜»å¡ï¼ˆthread-safe queueï¼‰

---

## 8. Dialogue Log æ¨¡çµ„

| é …ç›® | èªªæ˜ |
|------|------|
| **æ¨¡çµ„åç¨±** | `dialogue_logger.py` |
| **åŠŸèƒ½æ¦‚è¦** | å„²å­˜æ¯å¥åŸæ–‡ã€ç¿»è­¯çµæœã€Scenario Context èˆ‡æ™‚é–“æˆ³è¨˜ï¼Œç”Ÿæˆå¯ä¾›åˆ†æçš„èªæ–™ç´€éŒ„æª”ã€‚ |

### ğŸ”Œ Input / Output
| é¡å‹ | åç¨± | å‹åˆ¥ | æè¿° |
|------|------|------|------|
| Input | `record_entry` | dict | åŒ…å« `{timestamp, source, translation, context, language}` |
| Output | `.csv` / `.json` / `.txt` | å¯è®€æ ¼å¼ç´€éŒ„æª”ï¼Œä¾›åˆ†ææˆ–å†åˆ©ç”¨ |

### âš¡ äº‹ä»¶
| åç¨± | èªªæ˜ |
|------|------|
| `on_record_update` | æ¯ç•¶æ–°å¥å­å®Œæˆç¿»è­¯æ™‚è§¸ç™¼å¯«å…¥ |
| `on_file_rotate` | æª”æ¡ˆé”æŒ‡å®šå¤§å°æ™‚è‡ªå‹•åˆ†æ®µå„²å­˜ |

### ğŸ§  ä¾è³´
- æ¥æ”¶ STTã€LLMã€Context è¼¸å…¥  
- ä¸ä¾è³´ System Logï¼ˆç¨ç«‹å¯«å…¥ç³»çµ±ï¼‰

---

## 9. Runtime Check æ¨¡çµ„

| é …ç›® | èªªæ˜ |
|------|------|
| **æ¨¡çµ„åç¨±** | `runtime_checker.py` |
| **åŠŸèƒ½æ¦‚è¦** | æª¢æŸ¥ç³»çµ±ç’°å¢ƒèˆ‡æ¨¡å‹æª”æ¡ˆæ˜¯å¦å®Œæ•´ï¼Œæç¤ºä½¿ç”¨è€…å®‰è£ç¼ºå¤±é …ã€‚ |

### ğŸ”Œ Input / Output
| é¡å‹ | åç¨± | æè¿° |
|------|------|------|
| Output | `check_result` | è¿”å›ç‹€æ…‹èˆ‡å»ºè­°ä¿®å¾©æ­¥é©Ÿ |
| Output | GUI é€šçŸ¥ | æç¤ºä½¿ç”¨è€…ç¼ºå°‘çš„ä¾è³´ |

### âš¡ äº‹ä»¶
| åç¨± | èªªæ˜ |
|------|------|
| `on_check_complete` | æª¢æŸ¥å®Œæˆ |
| `on_missing_dependency` | åµæ¸¬åˆ°ç¼ºå¤±å…ƒä»¶æ™‚è§¸ç™¼æç¤º |

### ğŸ§  ä¾è³´
- GUIï¼ˆé¡¯ç¤ºæç¤ºï¼‰
- System Logï¼ˆè¨˜éŒ„æª¢æŸ¥çµæœï¼‰

---

## 10. Config æ¨¡çµ„

| é …ç›® | èªªæ˜ |
|------|------|
| **æ¨¡çµ„åç¨±** | `config_manager.py` |
| **åŠŸèƒ½æ¦‚è¦** | æ§åˆ¶ `config.json` çš„è®€å–èˆ‡æ›´æ–°ï¼Œç®¡ç† STT æ¨¡å‹é¸æ“‡ã€éŸ³æºè¨­å®šèˆ‡ API é‡‘é‘°ã€‚ |

### ğŸ”Œ Input / Output
| é¡å‹ | åç¨± | æè¿° |
|------|------|------|
| Input | `config.json` | ä½¿ç”¨è€…è¨­å®šæª” |
| Output | Python dict | æ‡‰ç”¨å…¨åŸŸè¨­å®š |

### âš¡ äº‹ä»¶
| åç¨± | èªªæ˜ |
|------|------|
| `on_config_update` | è¨­å®šæª”ä¿®æ”¹ä¸¦å»£æ’­è‡³æ‰€æœ‰æ¨¡çµ„ |

### ğŸ§  ä¾è³´
- GUI æ¨¡çµ„ï¼ˆè®€å–/å¯«å…¥ï¼‰
- å…¶ä»–æ‰€æœ‰æ¨¡çµ„ä½¿ç”¨é…ç½®åƒæ•¸

---

## ğŸ§© æ¨¡çµ„é–“äº‹ä»¶é—œè¯ç°¡è¡¨

| ä¾†æºæ¨¡çµ„ | äº‹ä»¶ | æ¥æ”¶æ¨¡çµ„ |
|-----------|-------|-----------|
| GUI | `on_start` | Audio, STT, LLM, Overlay |
| GUI | `on_stop` | å…¨æ¨¡çµ„ |
| Audio | `on_chunk_ready` | STT |
| STT | `on_partial_transcript` | Overlay |
| STT | `on_final_sentence` | LLM, Dialogue Log |
| LLM | `on_translation_ready` | Overlay, Dialogue Log |
| LLM | `on_context_update` | Scenario Context |
| System Log | `log_*` | æ§åˆ¶å° / æª”æ¡ˆ |
| Dialogue Log | `on_record_update` | â€” |

---

## ğŸ§± æ“´å……æ–¹å‘å»ºè­°

- ğŸ§  **æ–°å¢èªè¨€æ”¯æ´**ï¼šåœ¨ LLM ç¿»è­¯æ¨¡çµ„æ“´å……ç›®æ¨™èªè¨€æ¸…å–®å³å¯ã€‚  
- ğŸ§¾ **Subtitle Export**ï¼šDialogue Log æ¨¡çµ„å¯æ“´å…… `.srt` æˆ– `.vtt` è¼¸å‡ºã€‚  
- ğŸ§© **æ’ä»¶åŒ– STT æ¨¡å‹**ï¼šConfig æ¨¡çµ„æ”¯æ´ç¬¬ä¸‰æ–¹ STTï¼ˆå¦‚ WhisperXã€OpenAI Realtimeï¼‰ã€‚  
- ğŸ’¬ **å¤šä½¿ç”¨è€…ç›£è½**ï¼šOverlay å¯é¡¯ç¤ºå¤šè²é“ç¿»è­¯ï¼ˆæœªä¾†å¤šäººèªéŸ³å ´æ™¯ï¼‰ã€‚  

